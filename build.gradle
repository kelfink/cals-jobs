 buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.4'
    }
}

plugins {
	id 'net.saliman.cobertura' version '2.3.2'
    id 'org.sonarqube' version '2.0.1'
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'maven-publish'
apply plugin: 'com.github.johnrengelman.shadow'



project.ext {
    log4jVersion = "2.8"
    personIndexerJob = "gov.ca.cwds.jobs.PersonIndexerJob"
}

version = 0.20

repositories {
    mavenCentral()
    maven {
        url "http://maven2.cwds.tabordasolutions.net"
    }
}

dependencies {
    compile 'org.elasticsearch:elasticsearch:2.4.4'
    
	compile group: 'javax.validation', name: 'validation-api', version: '1.1.0.Final'
	compile group: 'org.apache.logging.log4j', name: 'log4j-api', version: log4jVersion
  	compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: log4jVersion
  	
	compile group: 'com.google.inject', name: 'guice', version: '4.1.0'
	compile group: "org.postgresql", name: "postgresql", version: "9.4.1208.jre7"
	compile group: "io.dropwizard", name: "dropwizard-hibernate", version: "1.0.0-rc4"

	compile group: "gov.ca.cwds.api", name: "api", version: "0.20.819"

    compile group: "org.glassfish.jersey.ext", name: "jersey-declarative-linking", version: "2.23.2"
	compile group: "javax.el", name: "javax.el-api", version: "2.2.4"
	compile group: "org.glassfish.web", name: "javax.el", version: "2.2.4"
	compile group: 'commons-beanutils', name: 'commons-beanutils', version: '1.8.3'

	compile group: 'org.slf4j', name: 'slf4j-ext', version: '1.7.22'
	compile 'com.fasterxml.jackson.module:jackson-module-guice:2.8.2'
    compile group: 'org.json', name: 'json', version: '20090211'
    
    compile fileTree(dir: 'lib', include: ['*.jar'])

    testCompile group: 'junit', name: 'junit', version: '4.+'
    testCompile group: 'org.hamcrest', name: 'hamcrest-junit', version: '2.0.0.0'
}

shadowJar {
  classifier = ''
  baseName = (System.properties.getProperty('baseName') != null) ? System.properties.getProperty('baseName') : 'DocumentIndexerJob'
  mergeServiceFiles()	
  manifest {
    attributes 'Main-Class': (System.properties.getProperty('mainClass') != null) ? System.properties.getProperty('mainClass') : 'gov.ca.cwds.jobs.DocumentIndexerJob'
  }
  version version + ((System.properties.getProperty('build') != null ) ? '.' + System.properties.getProperty('build') : '')
}

publishing {
  publications {
    shadow(MavenPublication) {
      from components.shadow
      groupId 'gov.ca.cwds.jobs'
      artifactId 'jobs'
        version version + ((System.properties.getProperty('build') != null ) ? '.' + System.properties.getProperty('build') : '')
    }
  }
  repositories {
    maven {
      //TODO : set to http url
      url "file:///usr/share/nginx/html/maven2"
    }
  }
}

cobertura {
	coverageFormats = ['xml', 'html']
	coverageIgnoreTrivial = true
	coverageExcludes  = ['org.slf4j.Logger.*', '.*gov\\.ca\\.cwds\\.jobs\\..*BasePersonIndexer.*']
	coverageIgnores = ['org.slf4j.Logger.*']
	coverageReportDir = new File("$buildDir/reports/cobertura")
}
