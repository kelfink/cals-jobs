-- DB2 View
-- ORDER BY clause is only valid on mainframe, remove it if running on other hosts.

DROP TABLE CWSRS1.ES_CLIENT_ADDRESS;

CREATE TABLE CWSRS1.ES_CLIENT_ADDRESS AS (
	SELECT 
	clt.IDENTIFIER AS clt_IDENTIFIER,
	clt.LST_UPD_ID AS clt_LST_UPD_ID,
	clt.LST_UPD_TS AS clt_LST_UPD_TS,
	clt.ADJDEL_IND AS clt_ADJDEL_IND,
	clt.ADPTN_STCD AS clt_ADPTN_STCD,
	clt.ALN_REG_NO AS clt_ALN_REG_NO,
	clt.BIRTH_CITY AS clt_BIRTH_CITY,
	clt.B_CNTRY_C  AS clt_B_CNTRY_C, 
	clt.BIRTH_DT   AS clt_BIRTH_DT,  
	clt.BR_FAC_NM  AS clt_BR_FAC_NM, 
	clt.B_STATE_C  AS clt_B_STATE_C, 
	clt.BP_VER_IND AS clt_BP_VER_IND,
	clt.CHLD_CLT_B AS clt_CHLD_CLT_B,
	clt.CL_INDX_NO AS clt_CL_INDX_NO,
	clt.COMMNT_DSC AS clt_COMMNT_DSC,
	clt.COM_FST_NM AS clt_COM_FST_NM,
	clt.COM_LST_NM AS clt_COM_LST_NM,
	clt.COM_MID_NM AS clt_COM_MID_NM,
	clt.CONF_ACTDT AS clt_CONF_ACTDT,
	clt.CONF_EFIND AS clt_CONF_EFIND,
	clt.CREATN_DT  AS clt_CREATN_DT, 
	clt.CURRCA_IND AS clt_CURRCA_IND,
	clt.COTH_DESC  AS clt_COTH_DESC, 
	clt.CURREG_IND AS clt_CURREG_IND,
	clt.DEATH_DT   AS clt_DEATH_DT,  
	clt.DTH_DT_IND AS clt_DTH_DT_IND,
	clt.DEATH_PLC  AS clt_DEATH_PLC, 
	clt.DTH_RN_TXT AS clt_DTH_RN_TXT,
	clt.DRV_LIC_NO AS clt_DRV_LIC_NO,
	clt.D_STATE_C  AS clt_D_STATE_C, 
	clt.EMAIL_ADDR AS clt_EMAIL_ADDR,
	clt.EST_DOB_CD AS clt_EST_DOB_CD,
	clt.ETH_UD_CD  AS clt_ETH_UD_CD, 
	clt.FTERM_DT   AS clt_FTERM_DT,  
	clt.GENDER_CD  AS clt_GENDER_CD, 
	clt.HEALTH_TXT AS clt_HEALTH_TXT,
	clt.HISP_UD_CD AS clt_HISP_UD_CD,
	clt.HISP_CD    AS clt_HISP_CD,   
	clt.I_CNTRY_C  AS clt_I_CNTRY_C, 
	clt.IMGT_STC   AS clt_IMGT_STC,  
	clt.INCAPC_CD  AS clt_INCAPC_CD, 
	clt.HCARE_IND  AS clt_HCARE_IND, 
	clt.LIMIT_IND  AS clt_LIMIT_IND, 
	clt.LITRATE_CD AS clt_LITRATE_CD,
	clt.MAR_HIST_B AS clt_MAR_HIST_B,
	clt.MRTL_STC   AS clt_MRTL_STC,  
	clt.MILT_STACD AS clt_MILT_STACD,
	clt.MTERM_DT   AS clt_MTERM_DT,  
	clt.NMPRFX_DSC AS clt_NMPRFX_DSC,
	clt.NAME_TPC   AS clt_NAME_TPC,  
	clt.OUTWRT_IND AS clt_OUTWRT_IND,
	clt.PREVCA_IND AS clt_PREVCA_IND,
	clt.POTH_DESC  AS clt_POTH_DESC, 
	clt.PREREG_IND AS clt_PREREG_IND,
	clt.P_ETHNCTYC AS clt_P_ETHNCTYC,
	clt.P_LANG_TPC AS clt_P_LANG_TPC,
	clt.RLGN_TPC   AS clt_RLGN_TPC,  
	clt.S_LANG_TC  AS clt_S_LANG_TC, 
	clt.SNTV_HLIND AS clt_SNTV_HLIND,
	clt.SENSTV_IND AS clt_SENSTV_IND,
	clt.SOCPLC_CD  AS clt_SOCPLC_CD, 
	clt.SOC158_IND AS clt_SOC158_IND,
	clt.SSN_CHG_CD AS clt_SSN_CHG_CD,
	clt.SS_NO      AS clt_SS_NO,    
	clt.SUFX_TLDSC AS clt_SUFX_TLDSC,
	clt.TRBA_CLT_B AS clt_TRBA_CLT_B,
	clt.TR_MBVRT_B AS clt_TR_MBVRT_B,
	clt.UNEMPLY_CD AS clt_UNEMPLY_CD,
	clt.ZIPPY_IND  AS clt_ZIPPY_IND, 
	clt.IBMSNAP_LOGMARKER AS clt_IBMSNAP_LOGMARKER,
	clt.IBMSNAP_OPERATION AS clt_IBMSNAP_OPERATION,
	cla.IDENTIFIER AS cla_IDENTIFIER,
	cla.LST_UPD_ID AS cla_LST_UPD_ID,
	cla.LST_UPD_TS AS cla_LST_UPD_TS,
	cla.ADDR_TPC   AS cla_ADDR_TPC,  
	cla.BK_INMT_ID AS cla_BK_INMT_ID,
	cla.EFF_END_DT AS cla_EFF_END_DT,
	cla.EFF_STRTDT AS cla_EFF_STRTDT,
	cla.FKADDRS_T  AS cla_FKADDRS_T, 
	cla.FKCLIENT_T AS cla_FKCLIENT_T,
	cla.FKREFERL_T AS cla_FKREFERL_T,
	cla.HOMLES_IND AS cla_HOMLES_IND,
	cla.IBMSNAP_LOGMARKER AS cla_IBMSNAP_LOGMARKER,
	cla.IBMSNAP_OPERATION AS cla_IBMSNAP_OPERATION,
	adr.IDENTIFIER AS ADR_IDENTIFIER,
	adr.LST_UPD_ID AS ADR_LST_UPD_ID,
	adr.LST_UPD_TS AS ADR_LST_UPD_TS,
	TRIM(adr.ADDR_DSC) AS ADR_ADDR_DSC,
	TRIM(adr.CITY_NM)  AS ADR_CITY_NM,
	adr.EMRG_EXTNO AS ADR_EMRG_EXTNO,
	adr.EMRG_TELNO AS ADR_EMRG_TELNO,
	adr.FRG_ADRT_B AS ADR_FRG_ADRT_B,
	adr.GVR_ENTC   AS ADR_GVR_ENTC,  
	TRIM(adr.HEADER_ADR) AS ADR_HEADER_ADR,
	adr.MSG_EXT_NO AS ADR_MSG_EXT_NO,
	adr.MSG_TEL_NO AS ADR_MSG_TEL_NO,
	TRIM(adr.POSTDIR_CD) AS ADR_POSTDIR_CD,
	TRIM(adr.PREDIR_CD) AS ADR_PREDIR_CD,
	adr.PRM_EXT_NO AS ADR_PRM_EXT_NO,
	adr.PRM_TEL_NO AS ADR_PRM_TEL_NO,
	adr.STATE_C AS ADR_STATE_C,   
	TRIM(adr.STREET_NM) AS ADR_STREET_NM,
	TRIM(adr.STREET_NO) AS ADR_STREET_NO,
	adr.ST_SFX_C AS ADR_ST_SFX_C,
	adr.UNT_DSGC AS ADR_UNT_DSGC,
	TRIM(adr.UNIT_NO) AS ADR_UNIT_NO,
	TRIM(adr.ZIP_NO) AS ADR_ZIP_NO,
	adr.ZIP_SFX_NO AS ADR_ZIP_SFX_NO,
	adr.IBMSNAP_LOGMARKER AS ADR_IBMSNAP_LOGMARKER,
	adr.IBMSNAP_OPERATION AS ADR_IBMSNAP_OPERATION,
	max(  clt.IBMSNAP_LOGMARKER, 
	  nvl(cla.IBMSNAP_LOGMARKER, TIMESTAMP_FORMAT('2008-09-30 11:54:40', 'YYYY-MM-DD HH24:MI:SS')),
	  nvl(adr.IBMSNAP_LOGMARKER, TIMESTAMP_FORMAT('2008-09-30 11:54:40', 'YYYY-MM-DD HH24:MI:SS'))
	) last_chg
	FROM CWSRS1.CLIENT_T clt
	LEFT OUTER JOIN CWSRS1.CL_ADDRT cla ON clt.IDENTIFIER = cla.FKCLIENT_T 
	LEFT OUTER JOIN CWSRS1.ADDRS_T  adr ON cla.FKADDRS_T  = adr.IDENTIFIER
	ORDER BY clt_IDENTIFIER
)
DATA INITIALLY DEFERRED
REFRESH DEFERRED
DISABLE QUERY OPTIMIZATION;

-- Execute following commands on linux hosts
SET INTEGRITY FOR CWSRS1.ES_CLIENT_ADDRESS MATERIALIZED QUERY IMMEDIATE UNCHECKED;
REFRESH TABLE CWSRS1.ES_CLIENT_ADDRESS ;