-- SET CURRENT SCHEMA = 'CWSRS1';

DROP VIEW VW_LST_CLIENT_ADDRESS;

CREATE VIEW VW_LST_CLIENT_ADDRESS (
  CLT_IDENTIFIER,
  CLT_LST_UPD_ID,
  CLT_LST_UPD_TS,
  CLT_ADJDEL_IND,
  CLT_ADPTN_STCD,
  CLT_ALN_REG_NO,
  CLT_BIRTH_CITY,
  CLT_B_CNTRY_C,
  CLT_BIRTH_DT,
  CLT_BR_FAC_NM,
  CLT_B_STATE_C,
  CLT_BP_VER_IND,
  CLT_CHLD_CLT_B,
  CLT_CL_INDX_NO,
  CLT_COMMNT_DSC,
  CLT_COM_FST_NM,
  CLT_COM_LST_NM,
  CLT_COM_MID_NM,
  CLT_CONF_ACTDT,
  CLT_CONF_EFIND,
  CLT_CREATN_DT,
  CLT_CURRCA_IND,
  CLT_COTH_DESC,
  CLT_CURREG_IND,
  CLT_DEATH_DT,
  CLT_DTH_DT_IND,
  CLT_DEATH_PLC,
  CLT_DTH_RN_TXT,
  CLT_DRV_LIC_NO,
  CLT_D_STATE_C,
  CLT_EMAIL_ADDR,
  CLT_EST_DOB_CD,
  CLT_ETH_UD_CD,
  CLT_FTERM_DT,
  CLT_GENDER_CD,
  CLT_HEALTH_TXT,
  CLT_HISP_UD_CD,
  CLT_HISP_CD,
  CLT_I_CNTRY_C,
  CLT_IMGT_STC,
  CLT_INCAPC_CD,
  CLT_HCARE_IND,
  CLT_LIMIT_IND,
  CLT_LITRATE_CD,
  CLT_MAR_HIST_B,
  CLT_MRTL_STC,
  CLT_MILT_STACD,
  CLT_MTERM_DT,
  CLT_NMPRFX_DSC,
  CLT_NAME_TPC,
  CLT_OUTWRT_IND,
  CLT_PREVCA_IND,
  CLT_POTH_DESC,
  CLT_PREREG_IND,
  CLT_P_ETHNCTYC,
  CLT_P_LANG_TPC,
  CLT_RLGN_TPC,
  CLT_S_LANG_TC,
  CLT_SNTV_HLIND,
  CLT_SENSTV_IND,
  CLT_SOCPLC_CD,
  CLT_SOC158_IND,
  CLT_SSN_CHG_CD,
  CLT_SS_NO,
  CLT_SUFX_TLDSC,
  CLT_TRBA_CLT_B,
  CLT_TR_MBVRT_B,
  CLT_UNEMPLY_CD,
  CLT_ZIPPY_IND,
  CLT_IBMSNAP_LOGMARKER,
  CLT_IBMSNAP_OPERATION,
  CLA_IDENTIFIER,
  CLA_LST_UPD_ID,
  CLA_LST_UPD_TS,
  CLA_ADDR_TPC,
  CLA_BK_INMT_ID,
  CLA_EFF_END_DT,
  CLA_EFF_STRTDT,
  CLA_FKADDRS_T,
  CLA_FKCLIENT_T,
  CLA_FKREFERL_T,
  CLA_HOMLES_IND,
  CLA_IBMSNAP_LOGMARKER,
  CLA_IBMSNAP_OPERATION,
  ADR_IDENTIFIER,
  ADR_LST_UPD_ID,
  ADR_LST_UPD_TS,
  ADR_ADDR_DSC,
  ADR_CITY_NM,
  ADR_EMRG_EXTNO,
  ADR_EMRG_TELNO,
  ADR_FRG_ADRT_B,
  ADR_GVR_ENTC,
  ADR_HEADER_ADR,
  ADR_MSG_EXT_NO,
  ADR_MSG_TEL_NO,
  ADR_POSTDIR_CD,
  ADR_PREDIR_CD,
  ADR_PRM_EXT_NO,
  ADR_PRM_TEL_NO,
  ADR_STATE_C,
  ADR_STREET_NM,
  ADR_STREET_NO,
  ADR_ST_SFX_C,
  ADR_UNT_DSGC,
  ADR_UNIT_NO,
  ADR_ZIP_NO,
  ADR_ZIP_SFX_NO,
  ADR_IBMSNAP_LOGMARKER,
  ADR_IBMSNAP_OPERATION,
  LAST_CHG
) AS 
SELECT 
clt.IDENTIFIER AS CLT_IDENTIFIER,
clt.LST_UPD_ID AS CLT_LST_UPD_ID,
clt.LST_UPD_TS AS CLT_LST_UPD_TS,
clt.ADJDEL_IND AS CLT_ADJDEL_IND,
clt.ADPTN_STCD AS CLT_ADPTN_STCD,
clt.ALN_REG_NO AS CLT_ALN_REG_NO,
clt.BIRTH_CITY AS CLT_BIRTH_CITY,
clt.B_CNTRY_C  AS CLT_B_CNTRY_C, 
clt.BIRTH_DT   AS CLT_BIRTH_DT,  
clt.BR_FAC_NM  AS CLT_BR_FAC_NM, 
clt.B_STATE_C  AS CLT_B_STATE_C, 
clt.BP_VER_IND AS CLT_BP_VER_IND,
clt.CHLD_CLT_B AS CLT_CHLD_CLT_B,
clt.CL_INDX_NO AS CLT_CL_INDX_NO,
clt.COMMNT_DSC AS CLT_COMMNT_DSC,
clt.COM_FST_NM AS CLT_COM_FST_NM,
clt.COM_LST_NM AS CLT_COM_LST_NM,
clt.COM_MID_NM AS CLT_COM_MID_NM,
clt.CONF_ACTDT AS CLT_CONF_ACTDT,
clt.CONF_EFIND AS CLT_CONF_EFIND,
clt.CREATN_DT  AS CLT_CREATN_DT, 
clt.CURRCA_IND AS CLT_CURRCA_IND,
clt.COTH_DESC  AS CLT_COTH_DESC, 
clt.CURREG_IND AS CLT_CURREG_IND,
clt.DEATH_DT   AS CLT_DEATH_DT,  
clt.DTH_DT_IND AS CLT_DTH_DT_IND,
clt.DEATH_PLC  AS CLT_DEATH_PLC, 
clt.DTH_RN_TXT AS CLT_DTH_RN_TXT,
clt.DRV_LIC_NO AS CLT_DRV_LIC_NO,
clt.D_STATE_C  AS CLT_D_STATE_C, 
clt.EMAIL_ADDR AS CLT_EMAIL_ADDR,
clt.EST_DOB_CD AS CLT_EST_DOB_CD,
clt.ETH_UD_CD  AS CLT_ETH_UD_CD, 
clt.FTERM_DT   AS CLT_FTERM_DT,  
clt.GENDER_CD  AS CLT_GENDER_CD, 
clt.HEALTH_TXT AS CLT_HEALTH_TXT,
clt.HISP_UD_CD AS CLT_HISP_UD_CD,
clt.HISP_CD    AS CLT_HISP_CD,   
clt.I_CNTRY_C  AS CLT_I_CNTRY_C, 
clt.IMGT_STC   AS CLT_IMGT_STC,  
clt.INCAPC_CD  AS CLT_INCAPC_CD, 
clt.HCARE_IND  AS CLT_HCARE_IND, 
clt.LIMIT_IND  AS CLT_LIMIT_IND, 
clt.LITRATE_CD AS CLT_LITRATE_CD,
clt.MAR_HIST_B AS CLT_MAR_HIST_B,
clt.MRTL_STC   AS CLT_MRTL_STC,  
clt.MILT_STACD AS CLT_MILT_STACD,
clt.MTERM_DT   AS CLT_MTERM_DT,  
clt.NMPRFX_DSC AS CLT_NMPRFX_DSC,
clt.NAME_TPC   AS CLT_NAME_TPC,  
clt.OUTWRT_IND AS CLT_OUTWRT_IND,
clt.PREVCA_IND AS CLT_PREVCA_IND,
clt.POTH_DESC  AS CLT_POTH_DESC, 
clt.PREREG_IND AS CLT_PREREG_IND,
clt.P_ETHNCTYC AS CLT_P_ETHNCTYC,
clt.P_LANG_TPC AS CLT_P_LANG_TPC,
clt.RLGN_TPC   AS CLT_RLGN_TPC,  
clt.S_LANG_TC  AS CLT_S_LANG_TC, 
clt.SNTV_HLIND AS CLT_SNTV_HLIND,
clt.SENSTV_IND AS CLT_SENSTV_IND,
clt.SOCPLC_CD  AS CLT_SOCPLC_CD, 
clt.SOC158_IND AS CLT_SOC158_IND,
clt.SSN_CHG_CD AS CLT_SSN_CHG_CD,
clt.SS_NO      AS CLT_SS_NO,    
clt.SUFX_TLDSC AS CLT_SUFX_TLDSC,
clt.TRBA_CLT_B AS CLT_TRBA_CLT_B,
clt.TR_MBVRT_B AS CLT_TR_MBVRT_B,
clt.UNEMPLY_CD AS CLT_UNEMPLY_CD,
clt.ZIPPY_IND  AS CLT_ZIPPY_IND, 
clt.IBMSNAP_LOGMARKER AS CLT_IBMSNAP_LOGMARKER,
clt.IBMSNAP_OPERATION AS CLT_IBMSNAP_OPERATION,
cla.IDENTIFIER AS CLA_IDENTIFIER,
cla.LST_UPD_ID AS CLA_LST_UPD_ID,
cla.LST_UPD_TS AS CLA_LST_UPD_TS,
cla.ADDR_TPC   AS CLA_ADDR_TPC,  
cla.BK_INMT_ID AS CLA_BK_INMT_ID,
cla.EFF_END_DT AS CLA_EFF_END_DT,
cla.EFF_STRTDT AS CLA_EFF_STRTDT,
cla.FKADDRS_T  AS CLA_FKADDRS_T, 
cla.FKCLIENT_T AS CLA_FKCLIENT_T,
cla.FKREFERL_T AS CLA_FKREFERL_T,
cla.HOMLES_IND AS CLA_HOMLES_IND,
cla.IBMSNAP_LOGMARKER AS CLA_IBMSNAP_LOGMARKER,
cla.IBMSNAP_OPERATION AS CLA_IBMSNAP_OPERATION,
adr.IDENTIFIER        AS ADR_IDENTIFIER,
adr.LST_UPD_ID        AS ADR_LST_UPD_ID,
adr.LST_UPD_TS        AS ADR_LST_UPD_TS,
TRIM(adr.ADDR_DSC)    AS ADR_ADDR_DSC,
TRIM(adr.CITY_NM)     AS ADR_CITY_NM,
adr.EMRG_EXTNO        AS ADR_EMRG_EXTNO,
adr.EMRG_TELNO        AS ADR_EMRG_TELNO,
adr.FRG_ADRT_B        AS ADR_FRG_ADRT_B,
adr.GVR_ENTC          AS ADR_GVR_ENTC,  
TRIM(adr.HEADER_ADR)  AS ADR_HEADER_ADR,
adr.MSG_EXT_NO        AS ADR_MSG_EXT_NO,
adr.MSG_TEL_NO        AS ADR_MSG_TEL_NO,
TRIM(adr.POSTDIR_CD)  AS ADR_POSTDIR_CD,
TRIM(adr.PREDIR_CD)   AS ADR_PREDIR_CD,
adr.PRM_EXT_NO        AS ADR_PRM_EXT_NO,
adr.PRM_TEL_NO        AS ADR_PRM_TEL_NO,
adr.STATE_C           AS ADR_STATE_C,   
TRIM(adr.STREET_NM)   AS ADR_STREET_NM,
TRIM(adr.STREET_NO)   AS ADR_STREET_NO,
adr.ST_SFX_C          AS ADR_ST_SFX_C,
adr.UNT_DSGC          AS ADR_UNT_DSGC,
TRIM(adr.UNIT_NO)     AS ADR_UNIT_NO,
TRIM(adr.ZIP_NO)      AS ADR_ZIP_NO,
adr.ZIP_SFX_NO        AS ADR_ZIP_SFX_NO,
adr.IBMSNAP_LOGMARKER AS ADR_IBMSNAP_LOGMARKER,
adr.IBMSNAP_OPERATION AS ADR_IBMSNAP_OPERATION,
MAX(  clt.IBMSNAP_LOGMARKER, 
  NVL(cla.IBMSNAP_LOGMARKER, TIMESTAMP('2008-09-30 11:54:40')),
  NVL(adr.IBMSNAP_LOGMARKER, TIMESTAMP('2008-09-30 11:54:40'))
) LAST_CHG
FROM CLIENT_T clt
LEFT JOIN CL_ADDRT cla ON clt.IDENTIFIER = cla.FKCLIENT_T 
LEFT JOIN ADDRS_T  adr ON cla.FKADDRS_T  = adr.IDENTIFIER
WHERE CLT.IDENTIFIER IN (
	SELECT GT.IDENTIFIER FROM GT_ID GT
);

COMMIT;
